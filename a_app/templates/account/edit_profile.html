{% extends "base.html" %}
{% block body %}
{% load static %}

<div class="flex min-h-screen bg-gray-50">
  {% include "profile_sidebar.html" %}

  <div class="flex-1 p-6">
    <div class="text-center mb-10">
      <h1 class="text-3xl font-semibold text-gray-800">Edit Profile</h1>
      <p class="text-gray-500">Update your personal information and account settings</p>
    </div>

    <!-- Edit Personal Details Form -->
    <form enctype="multipart/form-data" id="personalDetailsForm" method="POST" action="{% url 'edit_profile' %}" onsubmit="return validateEditForm()">
      {% csrf_token %}
      <div class="bg-white rounded-xl shadow p-6 mb-8 border border-gray-200">
        <h2 class="text-xl font-semibold text-gray-700 border-b-2 border-blue-500 inline-block pb-2 mb-4">Edit Personal Details</h2>

        <div class="bg-blue-50 border border-blue-200 text-blue-900 text-sm rounded-md p-3 mb-6">
          ðŸ’¡ <strong>Tip:</strong> Keep your information up to date to ensure smooth delivery and communication.
        </div>

        <!-- Grid Fields -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
          <!-- Full Name -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1" for="fullName">Full Name <span class="text-red-500">*</span></label>
            <input type="text" id="fullName" name="fullName" value="{{ user.first_name }}" onblur="nameValidation('fullName', 'nameErr')" required
                   class="w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200 p-3" />
            <span class="text-red-500 text-sm" id="nameErr"></span>
          </div>

          <!-- Email -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1" for="email">Email Address <span class="text-red-500">*</span></label>
            <input type="email" id="email" name="email" value="{{ user.email }}" onblur="emailValidation('email', 'emailErr')" required
                   class="w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200 p-3" />
            <span class="text-red-500 text-sm" id="emailErr"></span>
          </div>

          <!-- Phone -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1" for="phone">Phone Number <span class="text-red-500">*</span></label>
            <input type="tel" id="phone" name="phone" value="{{ user_profile.phone }}" onblur="contactValidation('phone', 'phoneErr')" required
                   class="w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200 p-3" />
            <span class="text-red-500 text-sm" id="phoneErr"></span>
          </div>

          <!-- Delivery Address -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1" for="deliveryAddress">Default Delivery Address</label>
            <select id="deliveryAddress" name="delivery_addr"
                    class="w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200 p-3">
              <option value="{{ delivery_address.id }}">{{ delivery_address }}</option>
              {% for address in delivery_addresses %}
              <option value="{{ address.id }}">{{ address.location }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Primary Address -->
          <div class="sm:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-1" for="address">Primary Address <span class="text-red-500">*</span></label>
            <textarea id="address" name="address" onblur="addressValidation('address', 'addressErr')" required
                      class="w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200 p-3 min-h-[100px]">{{ user_profile.address }}</textarea>
            <span class="text-red-500 text-sm" id="addressErr"></span>
          </div>
        </div>

        <!-- Profile Image -->
        <div class="mt-4">
          <label class="block text-sm font-medium text-gray-700 mb-1" for="profileImage">Profile Image</label>
          {% if user_profile.profile_image %}
          <img src="{{ user_profile.profile_image.url }}" alt="Current Image" class="h-20 w-20 rounded-lg object-cover mb-3" />
          {% endif %}
          <input type="file" id="profileImage" name="profile_image" accept="image/*"
                 class="w-full text-sm text-gray-500 border-gray-300 rounded-lg file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-600 hover:file:bg-blue-100" />
        </div>

        <!-- Buttons -->
        <div class="flex flex-wrap justify-end gap-3 mt-6">
          <a href="{% url 'profile' request.user.id %}" onclick="return confirm('Are you sure want to cancel?')"
             class="px-5 py-2.5 bg-gray-500 text-white rounded-lg hover:bg-gray-600">Cancel</a>
          <button type="submit" name="update_details"
                  class="px-5 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700">Update Personal Details</button>
        </div>
      </div>
    </form>

    <!-- Change Password Form -->
    <form id="passwordForm" method="POST" action="{% url 'edit_profile' %}" onsubmit="return validatePasswordForm()">
      {% csrf_token %}
      <div class="bg-white rounded-xl shadow p-6 border border-gray-200">
        <h2 class="text-xl font-semibold text-gray-700 border-b-2 border-blue-500 inline-block pb-2 mb-4">Change Password</h2>

        <div class="bg-blue-50 border border-blue-200 text-blue-900 text-sm rounded-md p-3 mb-6">
          ðŸ”’ <strong>Security:</strong> Choose a strong password with at least 8 characters, including uppercase, lowercase, numbers, and special characters.
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
          <!-- Current Password -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1" for="currentPassword">Current Password <span class="text-red-500">*</span></label>
            <div class="relative">
              <input type="password" id="currentPassword" name="currentPassword" required
                     class="w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200 p-3" />
              <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 cursor-pointer" onclick="togglePassword('currentPassword')">
                <i class="fa-solid fa-eye"></i>
              </span>
            </div>
            <span class="text-red-500 text-sm" id="currentPassErr"></span>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1" for="newPassword">New Password <span class="text-red-500">*</span></label>
            <div class="relative">
              <input type="password" id="newPassword" name="newPassword" onblur="passwordValidation('newPassword', 'newPassErr')" required
                     class="w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200 p-3" />
              <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 cursor-pointer" onclick="togglePassword('newPassword')">
                <i class="fa-solid fa-eye"></i>
              </span>
            </div>
            <span class="text-red-500 text-sm" id="newPassErr"></span>

            <div class="mt-2">
              <div class="h-1 bg-gray-200 rounded-full overflow-hidden">
                <div class="strength-fill h-full w-0"></div>
              </div>
              <span class="text-xs text-gray-500 strength-text">Password strength: Not entered</span>
            </div>
          </div>

          <div class="sm:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-1" for="confirmPassword">Confirm New Password <span class="text-red-500">*</span></label>
            <div class="relative">
              <input type="password" id="confirmPassword" name="confirmPassword" onblur="confirmPasswordValidation('newPassword', 'confirmPassword', 'confirmPassErr')" required
                     class="w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200 p-3" />
              <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 cursor-pointer" onclick="togglePassword('confirmPassword')">
                <i class="fa-solid fa-eye"></i>
              </span>
            </div>
            <span class="text-red-500 text-sm" id="confirmPassErr"></span>
            <div id="passwordMatch" class="text-xs text-gray-500 mt-1"></div>
          </div>
        </div>

        <div class="flex flex-wrap justify-end gap-3 mt-6">
          <a href="{% url 'profile' request.user.id %}" onclick="return confirm('Are you sure want to cancel?')"
             class="px-5 py-2.5 bg-gray-500 text-white rounded-lg hover:bg-gray-600">Cancel</a>
          <button type="submit" name="change_password"
                  class="px-5 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700">Change Password</button>
        </div>
      </div>
    </form>
  </div>
</div>

{% endblock body %}
